<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Fafnir: DriveTrain Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Fafnir
   </div>
   <div id="projectbrief">Team 8&#39;s 2013 Robot!</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.1.2 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li class="current"><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="classes.html"><span>Data&#160;Structure&#160;Index</span></a></li>
      <li><a href="functions.html"><span>Data&#160;Fields</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a>  </div>
  <div class="headertitle">
<div class="title">DriveTrain Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Controls the robot's movement.  
 <a href="classDriveTrain.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="DriveTrain_8h_source.html">DriveTrain.h</a>&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:add907b482a85d7c1be6bb4853582283c"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classDriveTrain.html#add907b482a85d7c1be6bb4853582283c">driveD</a> (double dist)</td></tr>
<tr class="memitem:aee1a46f797f47864ce65c5c2315af5af"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classDriveTrain.html#aee1a46f797f47864ce65c5c2315af5af">driveS</a> (double spd)</td></tr>
<tr class="memitem:a6a4f995cc3f11205973264df336014cc"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classDriveTrain.html#a6a4f995cc3f11205973264df336014cc">driveTo</a> (complex target)</td></tr>
<tr class="memitem:a88bb68b1e72a742aedddce29e97e481b"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classDriveTrain.html#a88bb68b1e72a742aedddce29e97e481b">rotateA</a> (double angle)</td></tr>
<tr class="memitem:ad92760b4ae82f65c2000426052f29a26"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classDriveTrain.html#ad92760b4ae82f65c2000426052f29a26">rotateS</a> (double rotSpd)</td></tr>
<tr class="memitem:ad85684c460c61021275c0713a664d06d"><td class="memItemLeft" align="right" valign="top">ShifterMode&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classDriveTrain.html#ad85684c460c61021275c0713a664d06d">getMode</a> ()</td></tr>
<tr class="memitem:a2f633207590a06ef4df640791945ae58"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classDriveTrain.html#a2f633207590a06ef4df640791945ae58">setMode</a> (ShifterMode mode)</td></tr>
<tr class="memitem:a61e1b7b58ca803ca1fa3553b5805cb7a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classDriveTrain.html#a61e1b7b58ca803ca1fa3553b5805cb7a">update</a> ()</td></tr>
</table>
<a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock"><p>Controls the robot's movement. </p>
<p>All driving commands on the robot, for both moving from one location to another, should take place through the <a class="el" href="classDriveTrain.html" title="Controls the robot&#39;s movement.">DriveTrain</a>. It will handle all movement events for the robot, apart from internal systems. The gearing system will also be part of the drive train, so there will be four motors to drive the robot (two for each side) and two pneumatic arms to switch gears. </p>
</div><h2>Member Function Documentation</h2>
<a class="anchor" id="add907b482a85d7c1be6bb4853582283c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool DriveTrain::driveD </td>
          <td>(</td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>dist</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Drive a distance </p>
<dl class="section remark"><dt>Remarks</dt><dd>This will override the target speed and target point; if target speed or point is set, this will unset it </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">dist</td><td>The distance to drive </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Whether setting target was successful </dd></dl>
<div class="fragment"><div class="line">                                {</div>
<div class="line">  <span class="comment">//set target distance  </span></div>
<div class="line">  <span class="comment">/* pseudo code</span></div>
<div class="line"><span class="comment">  *error = d - currentPosition</span></div>
<div class="line"><span class="comment">  PC_Dist.calculate()</span></div>
<div class="line"><span class="comment">  self.driveS(*output)</span></div>
<div class="line"><span class="comment">  </span></div>
<div class="line"><span class="comment">  // for drivetrain.h</span></div>
<div class="line"><span class="comment">  PIDController PC_Dist;</span></div>
<div class="line"><span class="comment">  </span></div>
<div class="line"><span class="comment">  // for constructor</span></div>
<div class="line"><span class="comment">  PC_Dist(1,0,.05,*error,*output,.05) // not sure if can give floats to the PIDController, constants need tuning (lots!)</span></div>
<div class="line"><span class="comment">  */</span></div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aee1a46f797f47864ce65c5c2315af5af"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool DriveTrain::driveS </td>
          <td>(</td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>spd</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Drive at a speed </p>
<dl class="section remark"><dt>Remarks</dt><dd>This will override the target distance and target point; if target distance or point is set, this will unset it </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">spd</td><td>The speed at which to drive </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Whether setting target was successful </dd></dl>
<div class="fragment"><div class="line">                                {</div>
<div class="line">  <span class="comment">//set target speed</span></div>
<div class="line">  <span class="keywordflow">if</span> (s &gt; gearCutoff) {</div>
<div class="line">    engageHigh();</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">  }</div>
<div class="line">  engageLow();</div>
<div class="line">  </div>
<div class="line">  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">  <span class="comment">// Don&#39;t delete this unless you want to be a douche (but move it around as much as you want to)</span></div>
<div class="line">  <span class="comment">// Ok people, this is how we use a PID controller to set the speed! (by Nathan)</span></div>
<div class="line">  <span class="comment">// PID control may not actually be optimal for speed, we&#39;ll need to do real testing</span></div>
<div class="line">  <span class="comment">// Here goes</span></div>
<div class="line">  <span class="comment">// PID: Input : currentSpeed - setSpeed, Output : acceleration</span></div>
<div class="line">  <span class="comment">// acceleration NEEDS to be the output (90% sure)</span></div>
<div class="line">  <span class="comment">// we can&#39;t output motor power because as currentSpeed reaches setSpeed, then motor power will go to zero</span></div>
<div class="line">  <span class="comment">// acceleration needs to be added to motorpower every time unit (tick)</span></div>
<div class="line">  <span class="comment">// We shouldn&#39;t use I (Konstant) unless there is slipping (not sure about this)</span></div>
<div class="line">  </div>
<div class="line">  <span class="comment">// for gears:</span></div>
<div class="line">  <span class="comment">// we need to find the ratios and multiply the ratio by motor power</span></div>
<div class="line">  <span class="comment">// thats all</span></div>
<div class="line">  </div>
<div class="line">  <span class="comment">// I don&#39;t like /* and */</span></div>
<div class="line">  </div>
<div class="line">  <span class="comment">/* pseudo code!</span></div>
<div class="line"><span class="comment">  // we may need to create a subclass of PIDSource just to hold a number (called outputNumberClass)</span></div>
<div class="line"><span class="comment">  // I&#39;m not sure how to create a PID controller without a PIDSource class</span></div>
<div class="line"><span class="comment">  </span></div>
<div class="line"><span class="comment">  // for drivetrain.h</span></div>
<div class="line"><span class="comment">  PIDController PC_speed;</span></div>
<div class="line"><span class="comment">  </span></div>
<div class="line"><span class="comment">  // for constructor</span></div>
<div class="line"><span class="comment">  PC_speed(1,0,.05,encoderLeft, victorLeft, outputNumberClass, .05) // constructor is in the form (Kp,Ki,Kd,source,output,period)</span></div>
<div class="line"><span class="comment">  // getting the right constants and ratios could take a lot of time and not be worth it</span></div>
<div class="line"><span class="comment">  </span></div>
<div class="line"><span class="comment">  // this needs to be called every tick</span></div>
<div class="line"><span class="comment">  power = power + outPutNumberClass.value()</span></div>
<div class="line"><span class="comment">  Victor.setPower(power)</span></div>
<div class="line"><span class="comment">  </span></div>
<div class="line"><span class="comment">  */</span></div>
<div class="line">  </div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a6a4f995cc3f11205973264df336014cc"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool DriveTrain::driveTo </td>
          <td>(</td>
          <td class="paramtype">complex&#160;</td>
          <td class="paramname"><em>target</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Drive to a point relative to the robot </p>
<dl class="section remark"><dt>Remarks</dt><dd>This will override the target distance and target speed; if target distance or speed is set, this will unset it </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">target</td><td>The target to drive to, relative to the robot's current location </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Whether setting target was successful </dd></dl>
<div class="fragment"><div class="line">                                               {</div>
<div class="line">  <span class="comment">//calculate polar coordinates (r, theta) then set values</span></div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Nathan&#39;s notes:</span></div>
<div class="line">  <span class="comment">// Steering_value = component_perpendicular_to_forward ( vector_to_target ).normalize.multiply(steering speed)</span></div>
<div class="line">  <span class="comment">// steering speed is important, should probably PID that</span></div>
<div class="line">  <span class="comment">// if you don&#39;t normalize and mult the value, then its basically a P controller</span></div>
<div class="line">  </div>
<div class="line">  <span class="comment">//Craig W. Reynolds steering algorithm (expanded to seek behavior) take a look at a simple boids program to further understand</span></div>
<div class="line">  <span class="comment">//boids written by me! http://openprocessing.org/sketch/67395</span></div>
<div class="line">  </div>
<div class="line">  <span class="comment">/* void seek(PVector target) {</span></div>
<div class="line"><span class="comment">    PVector desired = PVector.sub(target,location);</span></div>
<div class="line"><span class="comment">    desired.normalize();</span></div>
<div class="line"><span class="comment">    desired.mult(maxspeed);</span></div>
<div class="line"><span class="comment">    PVector steer = PVector.sub(desired,velocity);</span></div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="comment">    // Limit the magnitude of the steering force.</span></div>
<div class="line"><span class="comment">    steer.limit(maxforce);</span></div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="comment">    applyForce(steer);</span></div>
<div class="line"><span class="comment">  }</span></div>
<div class="line"><span class="comment">  */</span></div>
<div class="line">  </div>
<div class="line">  <span class="comment">// HOWEVER, this method most likely won&#39;t work because we can&#39;t accuratrly keep track of our current position</span></div>
<div class="line">  <span class="comment">// we may just have to turn to the angle and drive forward</span></div>
<div class="line">  <span class="comment">// the craigs reynold thing is for a moving seek target (so its like a feedback controller)</span></div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ad85684c460c61021275c0713a664d06d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">ShifterMode DriveTrain::getMode </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Get the current shifter mode </p>
<dl class="section return"><dt>Returns</dt><dd>the current mode of the shifter </dd></dl>
<div class="fragment"><div class="line">                                {</div>
<div class="line">  <span class="keywordflow">return</span> mode;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a88bb68b1e72a742aedddce29e97e481b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool DriveTrain::rotateA </td>
          <td>(</td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>angle</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Rotate an angle </p>
<dl class="section remark"><dt>Remarks</dt><dd>This will override the target rotational speed; if target rotational speed is set, this will unset it </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">angle</td><td>The angle to turn </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Whether setting target was successful </dd></dl>

</div>
</div>
<a class="anchor" id="ad92760b4ae82f65c2000426052f29a26"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool DriveTrain::rotateS </td>
          <td>(</td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>rotSpd</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Rotate at a speed </p>
<dl class="section remark"><dt>Remarks</dt><dd>This will override the target angle; if target angle is set, this will unset it </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">rotSpd</td><td>The speed at which to rotate </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Whether setting target was successful </dd></dl>
<div class="fragment"><div class="line">                                 {</div>
<div class="line">  <span class="comment">//set target speed</span></div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a2f633207590a06ef4df640791945ae58"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool DriveTrain::setMode </td>
          <td>(</td>
          <td class="paramtype">ShifterMode&#160;</td>
          <td class="paramname"><em>mode</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Set the shifter mode </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">mode</td><td>The new mode for the shifter </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Whether setting the mode was successful </dd></dl>
<div class="fragment"><div class="line">                                      {</div>
<div class="line">  <span class="keywordflow">switch</span> (s) {</div>
<div class="line">  <span class="keywordflow">case</span> HIGH_GEAR: </div>
<div class="line">    engageHigh();</div>
<div class="line">    mode = HIGH_GEAR;</div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line">  <span class="keywordflow">case</span> LOW_GEAR:</div>
<div class="line">    engageLow();</div>
<div class="line">    mode = LOW_GEAR;</div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line">  <span class="keywordflow">case</span> AUTO:</div>
<div class="line">    mode = AUTO;</div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line">  <span class="keywordflow">default</span>:</div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a61e1b7b58ca803ca1fa3553b5805cb7a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void DriveTrain::update </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Method that is constantly called by <a class="el" href="classRobot.html">Robot</a> </p>
<div class="fragment"><div class="line">                        {</div>
<div class="line">  <span class="keywordflow">if</span>(mode == AUTO) {</div>
<div class="line">    <span class="comment">//automatic shifting code</span></div>
<div class="line">    <span class="comment">//and stuff</span></div>
<div class="line">  }</div>
<div class="line">  <span class="comment">//check encoders</span></div>
<div class="line">  <span class="comment">//and do stuff with them</span></div>
<div class="line">  <span class="comment">//and stuff</span></div>
<div class="line">  </div>
<div class="line">  <span class="comment">//Drive Speed/Ang Speed</span></div>
<div class="line">      <span class="comment">//check dist since last tick</span></div>
<div class="line">      <span class="comment">//calc current speed</span></div>
<div class="line">      <span class="comment">//scale on a per wheel basis based on turn speed</span></div>
<div class="line">      <span class="comment">//PID loop it up</span></div>
<div class="line">  <span class="comment">//Drive Dist</span></div>
<div class="line">      <span class="comment">//check target vs actual distance</span></div>
<div class="line">      <span class="comment">//PID loop</span></div>
<div class="line">  <span class="comment">//Turn</span></div>
<div class="line">      <span class="comment">//check current angle with gyro vs target angle</span></div>
<div class="line">      <span class="comment">//PID</span></div>
<div class="line"></div>
<div class="line">  <span class="comment">//ISSUES</span></div>
<div class="line">      <span class="comment">//angle and speed can be absolute, distance cannot (reliably)</span></div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li><a class="el" href="DriveTrain_8h_source.html">DriveTrain.h</a></li>
<li>DriveTrain.cpp</li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Jan 24 2013 20:32:00 for Fafnir by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.1.2
</small></address>
</body>
</html>
